ioc_txt = "ioc_txt.txt"
ioc_stix = "ioc_stix.xml"
timestamp = "2022-07-20T19:52:13.854506+00:00"

f = open(ioc_txt,"r")
g = open(ioc_stix,"w")

g.write("""<stix:STIX_Package 
xmlns:FileObj="http://cybox.mitre.org/objects#FileObject-2"
xmlns:cybox="http://cybox.mitre.org/cybox-2"
xmlns:cyboxCommon="http://cybox.mitre.org/common-2"
xmlns:cyboxVocabs="http://cybox.mitre.org/default_vocabularies-2"
xmlns:example="http://example.com"
xmlns:indicator="http://stix.mitre.org/Indicator-2"
xmlns:stix="http://stix.mitre.org/stix-1"
xmlns:stixCommon="http://stix.mitre.org/common-1"
xmlns:stixVocabs="http://stix.mitre.org/default_vocabularies-1"
xmlns:ttp="http://stix.mitre.org/TTP-1"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ioc:{id}" version="1.2">
<stix:STIX_Header>
    <stix:Title>File Hash Reputation Service Results</stix:Title>
    <stix:Package_Intent xsi:type="stixVocabs:PackageIntentVocab-1.0">Indicators - Malware Artifacts</stix:Package_Intent>
</stix:STIX_Header>
<stix:Indicators>""".format(id=ioc_stix))

for line in f:
    
    # Deletes the '\n'
    hash = line[:-1]

    # Deletes the ';' from the hash read from the list of IoC using the loki format
    hash = hash[:-1]

    if len(hash)==64 :
        tipo_hash = "SHA256"
    if len(hash)==40 :
        tipo_hash = "SHA1"   
    if len(hash)==128 :
        tipo_hash = "SHA512"
    if len(hash)==56 :
        tipo_hash = "SHA224"
    if len(hash)==96 :
        tipo_hash = "SHA384"

    g.write("""
            <stix:Indicator id="ioc:{valor_hash}" timestamp="{time}" xsi:type='indicator:IndicatorType'>
                <indicator:Title>File Reputation for {tipo_hash}={valor_hash}</indicator:Title>
                <indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">File Hash Watchlist</indicator:Type>
                <indicator:Observable id="ioc:{valor_hash}">
                    <cybox:Object id="ioc:{valor_hash}">
                        <cybox:Properties xsi:type="FileObj:FileObjectType">
                            <FileObj:Hashes>
                                <cyboxCommon:Hash>
                                    <cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">{tipo_hash}</cyboxCommon:Type>
                                    <cyboxCommon:Simple_Hash_Value condition="Equals">{valor_hash}</cyboxCommon:Simple_Hash_Value>
                                </cyboxCommon:Hash>
                            </FileObj:Hashes>
                        </cybox:Properties>
                    </cybox:Object>
                </indicator:Observable>
                <indicator:Indicated_TTP>
                    <stixCommon:TTP id="ioc:{valor_hash}" timestamp="{time}" xsi:type='ttp:TTPType'>
                        <ttp:Title>Malicious file</ttp:Title>
                    </stixCommon:TTP>
                </indicator:Indicated_TTP>
                <indicator:Confidence timestamp="{time}">
                    <stixCommon:Value vocab_reference="https://en.wikipedia.org/wiki/Percentage" vocab_name="Percentage">75</stixCommon:Value>
                </indicator:Confidence>
            </stix:Indicator>""".format(time=timestamp,valor_hash=hash,tipo_hash=tipo_hash))

g.write("""
    </stix:Indicators>
</stix:STIX_Package>""")   

g.close()
f.close()








